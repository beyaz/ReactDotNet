import{a as F}from"./chunk-2W22VGCX.js";import{a as I,b as k,d as lt,f as Le,g as Lr,h as x}from"./chunk-GYULANB4.js";var pt=Le((jn,dt)=>{"use strict";var yr=function(e,t,r,o,n,s,a,i){if(!e){var c;if(t===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var p=[r,o,n,s,a,i],l=0;c=new Error(t.replace(/%s/g,function(){return p[l++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}};dt.exports=yr});var mt=Le((ss,ft)=>{function vr(e){return typeof e=="function"}ft.exports=vr});var Ue=Le((is,ht)=>{function Hr(){return!0}ht.exports=Hr});var T=x(pt());var ye=Cr;function Cr(e,t,r){var o=null,n=null,s=r&&r.leading,a=r&&r.trailing;s==null&&(s=!0),a==null&&(a=!s),s==!0&&(a=!1);var i=function(){o&&(clearTimeout(o),o=null)},c=function(){var l=n;i(),l&&l()},p=function(){var l=s&&!o,u=this,d=arguments;if(n=function(){return e.apply(u,d)},o||(o=setTimeout(function(){if(o=null,a)return n()},t)),l)return l=!1,n()};return p.cancel=i,p.flush=c,p}var Ce="__rpldy-logger-debug__",E={PENDING:"pending",ADDED:"added",PROCESSING:"processing",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ABORTED:"aborted",ERROR:"error"},h={PENDING:"pending",ADDED:"added",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ERROR:"error",ABORTED:"aborted"};var f={};Lr(f,{debugLog:()=>Fe,isDebugOn:()=>ut,setDebug:()=>Dr});var Fr=()=>typeof window=="object"&&!!window.document,b=Fr;var le=null,ut=()=>(typeof le!="boolean"&&(le=b()&&("location"in window&&!!~window.location.search.indexOf("rpldy_debug=true")||window[Ce]===!0)),!!le),Dr=e=>{b()&&(window[Ce]=e),le=e?!0:null},Fe=(...e)=>{ut()&&console.log(...e)};var Ur=(e,t,...r)=>{let o=(n,...s)=>new Promise((a,i)=>{let c=e(n,...s);c&&c.length?Promise.all(c).catch(i).then(p=>p&&a(!!~p.findIndex(l=>l===!1))):a(!1)});return t?o(t,...r):o},De=Ur;var P=x(mt());var Nr=e=>{let t=[].concat(e);return r=>r.map(o=>t.map(n=>o[n]).join())},wr=(e,t,r)=>{let o=!0,n=Nr(r);if(e&&t&&e.length===t.length){let s=n(e),a=n(t);o=!!s.find((i,c)=>i!==a[c])}return!o},de=wr;var gt=x(Ue()),Mr=e=>(0,gt.default)()?e:Object.freeze(e),O=Mr;var Gr=e=>{var t;return!!e&&typeof e=="object"&&(((t=Object.getPrototypeOf(e))==null?void 0:t.constructor.name)==="Object"||Object.getPrototypeOf(e)===null)},w=Gr;var ve=e=>w(e)||Array.isArray(e),kr=(e,t)=>{let r=Object.keys(e);return t.withSymbols?r.concat(Object.getOwnPropertySymbols(e)):r},H=(e={})=>{let t=(r,...o)=>(r&&o.length&&o.forEach(n=>{n&&kr(n,e).forEach(s=>{let a=n[s];(!e.predicate||e.predicate(s,a))&&(typeof a!="undefined"||e.undefinedOverwrites)&&(ve(a)?((typeof r[s]=="undefined"||!w(r[s]))&&(r[s]=Array.isArray(a)?[]:{}),t(r[s],a)):r[s]=a)})}),r);return t},B=H();var Vr=(e,t=B)=>ve(e)?t(Array.isArray(e)?[]:{},e):e,V=Vr;var Qr=(e,t)=>e&&Object.keys(e).reduce((r,o)=>(~t.indexOf(o)&&(r[o]=e[o]),r),{}),pe=Qr;var _=x(Ue());function $r(e){return!!e&&typeof e=="object"&&typeof e.then=="function"}var U=$r;var Ne=b()&&window.requestIdleCallback,zr=Ne?window.requestIdleCallback:setTimeout,Wr=Ne?window.cancelIdleCallback:clearTimeout,Yr=(e,t=0)=>{let r=zr(e,Ne?{timeout:t}:t);return()=>Wr(r)},Q=Yr;function Xr(e){return e==null}var j=Xr;var Zr=(e,t,...r)=>{let o=(n,...s)=>new Promise((a,i)=>{let c=e(n,...s);c&&c.length?Promise.all(c).catch(i).then(p=>{let l;if(p)for(;j(l)&&p.length;)l=p.pop();a(j(l)?void 0:l)}):a()});return t?o(t,...r):o},we=Zr;var St=Symbol.for("__rpldy-bi__"),Et=0,Jr=(e,t)=>(e.url=t,e),Kr=(e,t)=>(e.file=t,e),jr=e=>e&&(e instanceof File||e instanceof Blob||!!(typeof e=="object"&&e.name&&e.type)),ue=e=>!!(typeof e=="object"&&e.id&&e.batchId&&e[St]===!0),qr=(e,t,r=!1)=>{let o=ue(e);Et+=o?0:1;let n=o&&e.id&&typeof e.id=="string"?e.id:`${t}.item-${Et}`,s=r?h.PENDING:h.ADDED,a={id:n,batchId:t,state:s,uploadStatus:0,total:0,completed:0,loaded:0,recycled:o,previousBatch:o?e.batchId:null};Object.defineProperty(a,St,{value:!0,writable:!0});let i=o?e.file||e.url:e;if(typeof i=="string")a=Jr(a,i);else if(jr(i))a=Kr(a,i);else throw new Error(`Unknown type of file added: ${typeof i}`);return a},He=qr;var Me=class extends Promise{constructor(t,r){super(t),this.xhr=r}},fe=Me;var eo=(e,t)=>{t&&Object.keys(t).forEach(r=>{t[r]!==void 0&&e.setRequestHeader(r,t[r])})},to=(e,t,r={})=>{let o=new XMLHttpRequest;return new fe((n,s)=>{var a;o.onerror=()=>s(o),o.ontimeout=()=>s(o),o.onabort=()=>s(o),o.onload=()=>n(o),o.open((r==null?void 0:r.method)||"GET",e),eo(o,r==null?void 0:r.headers),o.withCredentials=!!(r!=null&&r.withCredentials),(a=r==null?void 0:r.preSend)==null||a.call(r,o),o.send(t)},o)},It=to;var ro=e=>{let t;try{t=e.getAllResponseHeaders().trim().split(/[\r\n]+/).reduce((r,o)=>{let[n,s]=o.split(": ");return r[n]=s,r},{})}catch(r){Fe("uploady.request: failed to read response headers",e)}return t},me=ro;var Ge=It;var oo=O({allowRegisterNonExistent:!0,canAddEvents:!0,canRemoveEvents:!0,collectStats:!1}),At=oo;var bt=(e,t)=>{if(!(0,P.default)(e))throw new Error(`'${t}' is not a valid function`)},Rt=e=>typeof e=="undefined";var ke=Symbol.for("__le__"),he=Symbol.for("__le__pack__");var xt=e=>e?e[ke]:null,D=e=>{let t=xt(e);if(!t)throw new Error("Didnt find LE internal object. Something very bad happened!");return t},Pt=e=>!!xt(e),_t=(e,t,r,o=!1)=>{bt(r,"cb");let n=D(e);if(!n.options.allowRegisterNonExistent&&!~n.events.indexOf(t))throw new Error(`Cannot register for event ${t.toString()} that wasn't already defined (allowRegisterNonExistent = false)`);let s=n.registry[t]||[];return s.find(a=>a.cb===r)||(s.push({name:t,cb:r,once:o}),n.registry[t]=s),()=>yt.call(e,t,r)},Ot=(e,t)=>{let r=D(e).registry;return t?r[t]?r[t].slice():[]:Object.values(r).flat()},no={on:ao,once:io,off:yt,getEvents:co},so=()=>Object.entries(no).reduce((e,[t,r])=>(e[t]={value:r},e),{}),Ve={trigger:lo,addEvent:uo,removeEvent:fo,hasEvent:mo,hasEventRegistrations:ho,assign:po},Bt=e=>Object.keys(Ve).reduce((t,r)=>(t[r]=Ve[r].bind(e),t),I({target:e},Ve)),Tt=(e,t,r=!1)=>{let o=D(e).registry;o[t]&&(r||!o[t].length)&&delete o[t]},Lt=(e,t,r)=>{let o=D(e).registry;o[t]&&(r?(o[t]=o[t].filter(n=>n.cb!==r),Tt(e,t)):Tt(e,t,!0))};function ao(e,t){return _t(this,e,t)}function io(e,t){return _t(this,e,t,!0)}function yt(e,t){Lt(this,e,t)}function co(){return D(this).events.slice()}function lo(e,...t){var n;let r=Ot(this,e),o;if(r.length){let s;t.length===1&&((n=t[0])==null?void 0:n[he])===!0&&(s=t[0].resolve()),o=r.map(a=>{let i;return a.once&&Lt(this,e,a.cb),s?i=a.cb(...s):t.length?t.length===1?i=a.cb(t[0]):t.length===2?i=a.cb(t[0],t[1]):t.length===3?i=a.cb(t[0],t[1],t[2]):i=a.cb(...t):i=a.cb(),i}).filter(a=>!Rt(a)).map(a=>U(a)?a:Promise.resolve(a))}return o&&(o.length?o:void 0)}function po(e){let t=D(this);return Ct(e,t.options,t.events,t.registry,t.stats),Bt(e)}function uo(e){let t=D(this);if(t.options.canAddEvents)if(!~t.events.indexOf(e))t.events.push(e);else throw new Error(`Event '${e}' already defined`);else throw new Error("Cannot add new events (canAddEvents = false)")}function fo(e){let t=D(this);if(t.options.canRemoveEvents){let r=t.events.indexOf(e);t.events.splice(r,1)}else throw new Error("Cannot remove events (canRemoveEvents = false)")}function mo(e){return!!~D(this).events.indexOf(e)}function ho(e){return!!Ot(this,e).length}var Ct=(e,t,r=[],o={},n={})=>{Object.defineProperties(e,I({[ke]:{value:Object.seal({registry:o,events:r,options:t,stats:n})}},so()))},go=(e,t=[],r)=>{let o=e||{},n=I(I({},At),r);return Pt(o)||Ct(o,n,t),Bt(o)},$=go;var Eo=e=>{let t={resolve:()=>[].concat(e())};return Object.defineProperty(t,he,{value:!0,configurable:!1}),t},Qe=Eo;var Ft=(e,t)=>{e.items.forEach(({id:r})=>{var o;return(o=t[r])==null?void 0:o.call(t)})},Dt=e=>{Object.values(e).forEach(t=>t())};var Ut=(e,t,r)=>(f.debugLog(`abort: aborting ${e.state} item  - `,e),r(e.id,{status:0,state:h.ABORTED,response:"aborted"}),!0),So={[h.UPLOADING]:(e,t)=>(f.debugLog("abort: aborting uploading item  - ",e),t[e.id]()),[h.ADDED]:Ut,[h.PENDING]:Ut},vt=(e,t,r)=>{let o=e==null?void 0:e.state,n=!!o&&So[o];return n?n(e,t,r):!1},$e=(e,t,r,o)=>vt(t[e],r,o),Nt=(e,t)=>{let r=!1;return t!==0&&t&&(r=e>=t),r},wt=(e,t,r,o,n)=>{let s=Object.values(r).flat(),a=Nt(s.length,n.fastAbortThreshold);return f.debugLog(`abort: doing abort-all (${a?"fast":"normal"} abort)`),a?Dt(t):s.forEach(i=>$e(i,e,t,o)),{isFast:a}},Ht=(e,t,r,o,n,s)=>{let a=t.fastAbortThreshold===0?0:t.fastAbortThreshold||s.fastAbortThreshold,i=Nt(o[e.id].length,a);return f.debugLog(`abort: doing abort-batch on: ${e.id} (${i?"fast":"normal"} abort)`),i?Ft(e,r):e.items.forEach(c=>vt(c,r,n)),{isFast:i}};var Io=()=>e=>(e.update({abortAll:wt,abortBatch:Ht,abortItem:$e}),e),Mt=Io;var ze=Mt;var m=O({BATCH_ADD:"BATCH-ADD",BATCH_START:"BATCH-START",BATCH_PROGRESS:"BATCH_PROGRESS",BATCH_FINISH:"BATCH-FINISH",BATCH_ABORT:"BATCH-ABORT",BATCH_CANCEL:"BATCH-CANCEL",BATCH_ERROR:"BATCH-ERROR",BATCH_FINALIZE:"BATCH-FINALIZE",ITEM_START:"FILE-START",ITEM_CANCEL:"FILE-CANCEL",ITEM_PROGRESS:"FILE-PROGRESS",ITEM_FINISH:"FILE-FINISH",ITEM_ABORT:"FILE-ABORT",ITEM_ERROR:"FILE-ERROR",ITEM_FINALIZE:"FILE-FINALIZE",REQUEST_PRE_SEND:"REQUEST_PRE_SEND",ALL_ABORT:"ALL_ABORT"}),Gt=50,M=O({ITEM_PROGRESS:"ITEM_PROGRESS",BATCH_PROGRESS:"BATCH_PROGRESS"}),ge=[h.FINISHED,h.ERROR,h.CANCELLED,h.ABORTED];var z=Symbol.for("__rpldy-sstt-proxy__"),q=Symbol.for("__rpldy-sstt-state__");var v=e=>!(0,_.default)()&&!!e&&!!~Object.getOwnPropertySymbols(e).indexOf(z),Ao=e=>b()&&e instanceof File||e.name&&e.size&&e.uri,ee=e=>Array.isArray(e)||w(e)&&!Ao(e);var bo=H({withSymbols:!0,predicate:e=>e!==z&&e!==q}),We=e=>(0,_.default)()?!0:e[q].isUpdateable,kt=(e,t)=>{(0,_.default)()||(e[q].isUpdateable=t)},Ye=(e,t)=>{let r;return ee(e)&&(v(e)||(e[z]=!0,r=new Proxy(e,t)),Object.keys(e).forEach(o=>{e[o]=Ye(e[o],t)})),r||e},y=e=>v(e)?V(e,bo):e,Ro=e=>{let t={set:(o,n,s)=>(We(r)&&(o[n]=Ye(s,t)),!0),get:(o,n)=>n===z?y(o):o[n],defineProperty:()=>{throw new Error("Simple State doesnt support defining property")},setPrototypeOf:()=>{throw new Error("Simple State doesnt support setting prototype")},deleteProperty:(o,n)=>(We(r)&&delete o[n],!0)};!(0,_.default)()&&!v(e)&&Object.defineProperty(e,q,{value:{isUpdateable:!1},configurable:!0});let r=(0,_.default)()?e:Ye(e,t);return{state:r,update:o=>{if(!(0,_.default)()&&We(r))throw new Error("Can't call update on State already being updated!");try{kt(r,!0),o(r)}finally{kt(r,!1)}return r},unwrap:o=>o?y(o):v(r)?y(r):r}},Ee=Ro;var Se=(e,t,r=!1)=>{e.updateState(o=>{let{batchId:n}=o.items[t]||{batchId:null};r&&delete o.items[t];let s=n?o.itemQueue[n].indexOf(t):-1;~s&&n&&o.itemQueue[n].splice(s,1);let a=o.activeIds.indexOf(t);~a&&o.activeIds.splice(a,1)})},Xe=(e,t)=>!!e.getState().items[t],W=e=>ge.includes(e.state);var To=H({undefinedOverwrites:!0}),xo=(e,t,r,o)=>{let n=r,s=t;if(o){if(f.debugLog(`uploader.queue: REQUEST_PRE_SEND(${e}) event returned updated items/options`,o),o.items){if(o.items.length!==t.length||!de(o.items,t,["id","batchId","recycled"]))throw new Error(`REQUEST_PRE_SEND(${e}) event handlers must return same items with same ids`);s=o.items}o.options&&(n=To({},r,o.options))}return{items:s,options:n,cancelled:o===!1}},Po=(e,t,r,o,n,s)=>we(e.trigger,n,t,o).then(a=>(s==null||s(a),xo(n,r,o,a))),_o=(e,t)=>{if(t.items[0]&&e.getState().batches[t.items[0].batchId]){e.updateState(o=>{t.items.forEach(n=>{W(o.items[n.id])||(o.items[n.id]=n)}),o.batches[t.items[0].batchId].batchOptions=t.options});let r=e.getState();t.items=t.items.map(o=>r.items[o.id]),t.options=r.batches[t.items[0].batchId].batchOptions}},Oo=(e,t,r,o,n,s)=>{let a=r(t),i=e.getState().batches[a[0].batchId].batchOptions,c=(o==null?void 0:o(t,i))||t;return Po(e,c,a,i,s,n).then(p=>(p.cancelled||_o(e,p),p))},Ie=(e,t,r=null,o=null)=>(n,s)=>Oo(n,s,t,r,o,e);var Bo=Ie(m.BATCH_START,e=>e.items,null,({batch:e}={batch:!1})=>{if(e)throw new Error("BATCH_START event handlers cannot update batch data. Only items & options")}),Lo=[E.ADDED,E.PROCESSING,E.UPLOADING],yo=[E.ABORTED,E.CANCELLED,E.FINISHED,E.ERROR],N=(e,t)=>e.batches[t].batch,Co=(e,t)=>N(e.getState(),t),Y=(e,t)=>{let r=e.getState(),o=r.items[t];return r.batches[o.batchId]},re=(e,t)=>Y(e,t).batch,Ae=(e,t)=>{Co(e,t).items.forEach(({id:o})=>Se(e,o,!0))},be=(e,t)=>{e.updateState(r=>{delete r.batches[t],delete r.itemQueue[t];let o=r.batchQueue.indexOf(t);~o&&r.batchQueue.splice(o,1);let n=r.batchesStartPending.indexOf(t);~n&&r.batchesStartPending.splice(n,1)})},oe=(e,t,r,o=E.FINISHED,n)=>{e.updateState(s=>{let a=N(s,t);a.state=o,n&&(a.additionalInfo=n)}),te(e,t,r),te(e,t,m.BATCH_FINALIZE)},Ze=(e,t)=>{f.debugLog("uploady.uploader.batchHelpers: cancelling batch: ",t),oe(e,t,m.BATCH_CANCEL,E.CANCELLED),Ae(e,t),be(e,t)},Vt=(e,t)=>{if(Xe(e,t)){let r=Y(e,t),o=r==null?void 0:r.batch.id;o?Ze(e,o):f.debugLog(`uploady.uploader.batchHelpers: cancel batch called for batch already removed (item id = ${t})`)}},Qt=(e,t,r)=>{let o=re(e,t),n=o.id;f.debugLog("uploady.uploader.batchHelpers: failing batch: ",{batch:o}),oe(e,n,m.BATCH_ERROR,E.ERROR,r.message),Ae(e,n),be(e,n)},$t=(e,t)=>{let r=re(e,t);return e.getState().batchesStartPending.includes(r.id)},zt=(e,t)=>{let r=re(e,t);return e.getState().currentBatch!==r.id},Wt=(e,t)=>{let r=re(e,t);return e.updateState(o=>{o.batchesStartPending.push(r.id)}),Bo(e,r).then(({cancelled:o})=>{let n=!1;return e.updateState(s=>{let a=s.batchesStartPending.indexOf(r.id);s.batchesStartPending.splice(a,1)}),o||(n=!Xe(e,t),n||e.updateState(s=>{s.currentBatch=r.id})),!o&&!n})},Yt=e=>{Q(()=>{let t=e.getState();Object.keys(t.batches).forEach(r=>{let{batch:o,finishedCounter:n}=t.batches[r],{orgItemCount:s}=o,a=Je(o);s===n&&(!a&&o.completed!==100&&(e.updateState(i=>{let c=N(i,r);c.completed=100,c.loaded=c.items.reduce((p,{loaded:l})=>p+l,0)}),te(e,r,m.BATCH_PROGRESS)),e.updateState(i=>{i.currentBatch===r&&(i.currentBatch=null)}),f.debugLog(`uploady.uploader.batchHelpers: cleaning up batch: ${o.id}`),a||oe(e,r,m.BATCH_FINISH),Ae(e,r),be(e,r))})})},te=(e,t,r)=>{let o=e.getState(),{batch:n,batchOptions:s}=o.batches[t],a=o.items,i=k(I({},y(n)),{items:n.items.map(({id:c})=>y(a[c]))});e.trigger(r,i,y(s))},Xt=(e,t)=>{let r=N(e.getState(),t);return Lo.includes(r.state)},Zt=(e,t)=>{let{previousBatch:r}=t;if(t.recycled&&r&&e.getState().batches[r]){let{id:o}=re(e,t.id);o===r&&e.updateState(n=>{let s=N(n,o),a=s.items.findIndex(({id:i})=>i===t.id);~a&&s.items.splice(a,1)})}},Jt=(e,t)=>{e.updateState(r=>{Object.keys(r.batches).forEach(o=>{let n=r.batches[o],{batch:s,batchOptions:a}=n;s.state===E.PENDING&&(s.items.forEach(i=>{i.state=h.ADDED}),s.state=E.ADDED,n.batchOptions=B({},a,t))})})},Kt=e=>{let t=e.getState().batches;Object.keys(t).filter(r=>t[r].batch.state===E.PENDING).forEach(r=>{Ae(e,r),be(e,r)})},jt=(e,t)=>{e.updateState(r=>{r.batches[t].finishedCounter+=1})},Je=e=>yo.includes(e.state),qt=(e,t)=>{e.updateState(r=>{let{items:o}=N(r,t);delete r.batches[t],delete r.itemQueue[t];let n=r.batchQueue.indexOf(t);~n&&r.batchQueue.splice(n,1),r.currentBatch===t&&(r.currentBatch=null),o.forEach(({id:s})=>{delete r.items[s];let a=r.activeIds.indexOf(s);~a&&r.activeIds.splice(a,1)})})};var er={[h.PENDING]:null,[h.ADDED]:m.ITEM_START,[h.FINISHED]:m.ITEM_FINISH,[h.ERROR]:m.ITEM_ERROR,[h.CANCELLED]:m.ITEM_CANCEL,[h.ABORTED]:m.ITEM_ABORT,[h.UPLOADING]:m.ITEM_PROGRESS},tr=e=>!!~ge.indexOf(e.state),Fo=(e,t,r)=>{t.forEach(o=>{var i;let n=e.getState(),{id:s,info:a}=o;if(f.debugLog("uploader.processor.queue: request finished for item - ",{id:s,info:a}),n.items[s]){e.updateState(l=>{let u=l.items[s];u.state=a.state,u.uploadResponse=a.response,u.uploadStatus=a.status,tr(u)&&delete l.aborts[s]});let c=e.getState().items[s];if(a.state===h.FINISHED&&c.completed<100){let l=((i=c.file)==null?void 0:i.size)||0;e.handleItemProgress(c,100,l,l)}let{batchOptions:p}=Y(e,s);er[c.state]&&e.trigger(er[c.state],c,p),tr(c)&&(jt(e,c.batchId),e.trigger(m.ITEM_FINALIZE,c,p))}Se(e,s)}),Yt(e),r(e)},X=Fo;var Do=Ie(m.REQUEST_PRE_SEND,e=>e,(e,t)=>({items:e,options:t})),Uo=(e,t,r)=>{e.updateState(o=>{t.forEach(n=>{let s=o.items[n.id];s.state=h.UPLOADING,o.aborts[n.id]=r.abort})})},vo=(e,t,r)=>{var a;let{items:o,options:n}=t,s=(a=e.getState().batches[o[0].batchId])==null?void 0:a.batch;if(s){let i;try{i=e.sender.send(o,s,n)}catch(p){f.debugLog("uploader.queue: sender failed with unexpected error",p),i={request:Promise.resolve({status:0,state:h.ERROR,response:p.message}),abort:()=>!1,senderType:"exception-handler"}}let{request:c}=i;Uo(e,o,i),c.then(p=>{let l=o.map(u=>({id:u.id,info:p}));X(e,l,r)})}},No=(e,t,r,o)=>{let n=r.map((s,a)=>s?t[a].id:null).filter(Boolean);if(n.length){let s=n.map(a=>({id:a,info:{status:0,state:h.CANCELLED,response:"cancel"}}));X(e,s,o)}return!!n.length},wo=(e,t,r,o)=>{let n=r.map(({id:s})=>({id:s,info:{status:0,state:h.ERROR,response:e}}));X(t,n,o)},Ho=(e,t)=>{let r=t.getState().items[e];return r&&!W(r)?r:void 0},Mo=({allowedItems:e,cancelledResults:t,queue:r,items:o,ids:n,next:s})=>{let a=e.length?Do(r,e):Promise.resolve(),i=t;return a.catch(c=>{f.debugLog("uploader.queue: encountered error while preparing items for request",c),wo(c,r,o,s)}).then(c=>{let p;return c&&(c.cancelled?i=n.map(()=>!0):c.items.some(u=>W(u))?f.debugLog("uploader.queue: send data contains aborted items - not sending"):vo(r,{items:c.items,options:c.options},s)),No(r,o,i,s)||(p=s(r)),p})},Go=(e,t,r)=>{let o=e.getState(),n=Object.values(o.items);return n=n.filter(s=>t.includes(s.id)&&!W(s)),Promise.all(n.map(s=>{let{batchOptions:a}=Y(e,s.id);return e.runCancellable(m.ITEM_START,s,a)})).then(s=>({allowedItems:s.map((i,c)=>i?null:Ho(n[c].id,e)).filter(Boolean),cancelledResults:s,queue:e,items:n,ids:t,next:r})).then(Mo)},rr=Go;var ko=(e,t)=>e.getState().activeIds.flat().includes(t),Vo=e=>e.state===h.ADDED,Qo=e=>{let t=e.getState(),r=t.itemQueue,o=t.items,n=null,s=0,a=0,i=t.batchQueue[s];for(;i&&!n;){if(Xt(e,i))for(n=r[i][a];n&&(ko(e,n)||!Vo(o[n]));)a+=1,n=r[i][a];n||(s+=1,i=t.batchQueue[s],a=0)}return n?[i,a]:null},$o=e=>{let t=e.getState(),r=t.itemQueue,[o,n]=Qo(e)||[],s=o&&~n?r[o][n]:null,a;if(s){let{batchOptions:i}=t.batches[o],c=i.maxGroupSize||0;i.grouped&&c>1?a=t.itemQueue[o].slice(n,n+c):a=[s]}return a},zo=(e,t)=>{e.updateState(r=>{r.activeIds=r.activeIds.concat(t)})},Wo=(e,t)=>{let r;return $t(e,t[0])?r=Promise.resolve(!0):(zo(e,t),zt(e,t[0])?r=Wt(e,t[0]).then(o=>{let n=!o;return n&&(Vt(e,t[0]),ne(e)),n}).catch(o=>(f.debugLog("uploader.processor: encountered error while preparing batch for request",o),Qt(e,t[0],o),ne(e),!0)):r=Promise.resolve(!1)),r},ne=e=>{let t,r=$o(e);if(r){let o=e.getCurrentActiveCount(),{concurrent:n=!1,maxConcurrent:s=0}=e.getOptions();(!o||n&&o<s)&&(f.debugLog("uploader.processor: Processing next upload - ",{ids:r,currentCount:o}),t=Wo(e,r).then(a=>{a||(rr(e,r,ne),n&&ne(e))}))}return t},se=ne;var Ke=e=>(t,r)=>X(e,[{id:t,info:r}],se),or=(e,t)=>{let r=e.getOptions().abortItem;(0,T.default)(!!r,"Abort Item method not provided yet abortItem was called");let o=e.getState();return r(t,o.items,o.aborts,Ke(e))},nr=(e,t)=>{let r=e.getOptions().abortBatch;(0,T.default)(!!r,"Abort Batch method not provided yet abortItem was called");let o=e.getState(),n=o.batches[t],s=n==null?void 0:n.batch;if(s&&!Je(s)){oe(e,t,m.BATCH_ABORT,E.ABORTED);let{isFast:a}=r(s,n.batchOptions,o.aborts,o.itemQueue,Ke(e),e.getOptions());a&&e.clearBatchUploads(s.id)}},sr=e=>{let t=e.getOptions().abortAll;(0,T.default)(!!t,"Abort All method not provided yet abortAll was called"),e.trigger(m.ALL_ABORT);let r=e.getState(),{isFast:o}=t(r.items,r.aborts,r.itemQueue,Ke(e),e.getOptions());o&&e.clearAllUploads()};var Yo=(e,t,r,o,n)=>{let{state:s,update:a}=Ee({itemQueue:{},batchQueue:[],currentBatch:null,batchesStartPending:[],batches:{},items:{},activeIds:[],aborts:{}}),i=()=>s,c=d=>{a(d)},p=d=>{if(s.items[d.id]&&!d.recycled)throw new Error(`Uploader queue conflict - item ${d.id} already exists`);d.recycled&&Zt(u,d),c(g=>{g.items[d.id]=d})},l=(d,g,S,R)=>{s.items[d.id]&&(c(ce=>{let C=ce.items[d.id];C.loaded=S,C.completed=g,C.total=R}),t(m.ITEM_PROGRESS,i().items[d.id]))};o.on(M.ITEM_PROGRESS,l),o.on(M.BATCH_PROGRESS,d=>{var S;let g=(S=s.batches[d.id])==null?void 0:S.batch.items;if(g){let[R,ce]=g.reduce((C,{id:K})=>{let{loaded:ct,file:Be}=s.items[K],Br=(Be==null?void 0:Be.size)||ct||1;return C[0]+=ct,C[1]+=Br,C},[0,0]);c(C=>{let K=C.batches[d.id].batch;K.total=ce,K.loaded=R,K.completed=R/ce}),te(u,d.id,m.BATCH_PROGRESS)}});let u={uploaderId:n,getOptions:()=>e,getCurrentActiveCount:()=>s.activeIds.length,getState:i,updateState:c,trigger:t,runCancellable:(d,...g)=>{if(!(0,P.default)(r))throw new Error("Uploader queue - cancellable is of wrong type");return r(d,...g)},sender:o,handleItemProgress:l,clearAllUploads:()=>{u.updateState(d=>{d.itemQueue={},d.batchQueue=[],d.currentBatch=null,d.batches={},d.items={},d.activeIds=[]})},clearBatchUploads:d=>{Q(()=>{f.debugLog(`uploader.queue: started scheduled work to clear batch uploads (${d})`),i().batches[d]&&qt(u,d)})}};return b()&&f.isDebugOn()&&(window[`__rpldy_${n}_queue_state`]=u),{updateState:c,getState:u.getState,runCancellable:u.runCancellable,uploadBatch:(d,g)=>{g&&c(S=>{S.batches[d.id].batchOptions=g}),se(u)},addBatch:(d,g)=>(c(S=>{S.batches[d.id]={batch:d,batchOptions:g,finishedCounter:0},S.batchQueue.push(d.id),S.itemQueue[d.id]=d.items.map(({id:R})=>R)}),d.items.forEach(p),N(s,d.id)),abortItem:(...d)=>or(u,...d),abortBatch:(...d)=>nr(u,...d),abortAll:(...d)=>sr(u,...d),clearPendingBatches:()=>{Kt(u)},uploadPendingBatches:d=>{Jt(u,d),se(u)},cancelBatch:d=>Ze(u,d.id)}},je=Yo;var Re="rpldy-sender";var Z=class extends Error{constructor(t){super(`${t} didn't receive upload URL`),this.name="MissingUrlError"}};var qe=(e,t,...r)=>{"set"in e?e.set(t,...r):("delete"in e&&e.delete(t),e.append(t,...r))},Xo=(e,t,r)=>{let o=t.length===1;t.forEach((n,s)=>{let a=o?r.paramName:(0,P.default)(r.formatGroupParamName)?r.formatGroupParamName(s,r.paramName):`${r.paramName}[${s}]`;n.file?qe(e,a,n.file,n.file.name):n.url&&qe(e,a,n.url)})},Zo=(e,t)=>{let r=new FormData;return t.params&&Object.entries(t.params).forEach(([o,n])=>{(t.formDataAllowUndefined||n!==void 0)&&qe(r,o,n)}),Xo(r,e,t),r},ar=Zo;var Jo=[200,201,202,203,204],Ko=(e,t)=>{let r;if(t.sendWithFormData)f.debugLog(`uploady.sender: sending ${e.length} item(s) as form data`),r=ar(e,t);else{if(e.length>1)throw new Error(`XHR Sender - Request without form data can only contain 1 item. received ${e.length}`);let o=e[0];f.debugLog(`uploady.sender: sending item ${o.id} as request body`),r=o.file||o.url}return r},jo=(e,t,r,o,n)=>{let s,a=n!=null&&n.getRequestData?n.getRequestData(e,r):Ko(e,r),i=(p=t,l=a,u)=>{let d=B(k(I({},pe(r,["method","headers","withCredentials"])),{preSend:S=>{S.upload.onprogress=R=>{R.lengthComputable&&o&&o(R,e.slice())}}}),u),g=Ge(p,l,d);return s=g.xhr,g},c=n!=null&&n.preRequestHandler?n.preRequestHandler(i,e,t,r,o,n):i();return{url:t,count:e.length,pXhr:c,getXhr:()=>s,aborted:!1}},qo=(e,t,r)=>{let o=e,n=t==null?void 0:t["content-type"];if(r.forceJsonResponse||n!=null&&n.includes("json"))try{o=JSON.parse(e)}catch(s){}return o},en=(e,t)=>{let r=t.isSuccessfulCall?t.isSuccessfulCall(e):Jo.includes(e.status);return U(r)?r:Promise.resolve(r)},tn=(e,t)=>e.pXhr.then(r=>(f.debugLog("uploady.sender: received upload response ",r),en(r,t).then(o=>{var c,p;let n=o?h.FINISHED:h.ERROR,s=r.status,a=me(r),i={data:(p=(c=t.formatServerResponse)==null?void 0:c.call(t,r.response,s,a))!=null?p:qo(r.response,a,t),headers:a};return{status:s,state:n,response:i}}))).catch(r=>{let o,n;return e.aborted?(o=h.ABORTED,n="aborted"):(f.debugLog("uploady.sender: upload failed: ",r),o=h.ERROR,n=r),{error:!0,state:o,response:n,status:0}}),rn=e=>{let t=!1,{aborted:r,getXhr:o}=e,n=o();return!r&&n&&n.readyState&&n.readyState!==4&&(f.debugLog(`uploady.sender: cancelling request with ${e.count} items to: ${e.url}`),n.abort(),e.aborted=!0,t=!0),t},on=e=>(t,r,o,n)=>{if(!r)throw new Z(Re);f.debugLog("uploady.sender: sending file: ",{items:t,url:r,options:o});let s=jo(t,r,o,n,e);return{request:tn(s,o),abort:()=>rn(s),senderType:Re}},ir=on;var nn=ir(),cr=nn;var lr="file",et=()=>!0,ae=O({autoUpload:!0,clearPendingOnAdd:!1,inputFieldName:"file",concurrent:!1,maxConcurrent:2,grouped:!1,maxGroupSize:5,method:"POST",params:{},fileFilter:et,forceJsonResponse:!1,withCredentials:!1,destination:{},send:null,sendWithFormData:!0,formDataAllowUndefined:!1,fastAbortThreshold:100});var sn=(e,t,r,o,n)=>{e.forEach(s=>{f.debugLog(`uploady.uploader.processor: file: ${s.id} progress event: loaded(${r}) - completed(${t})`),n(M.ITEM_PROGRESS,s,t,r,o)})},an=(e,t,r,o)=>{let n=Math.min(r.loaded/r.total*100,100),s=n/e.length,a=r.loaded/e.length;sn(e,s,a,r.total,o),o(M.BATCH_PROGRESS,t)},cn=()=>{let{trigger:e,target:t}=$({send:(r,o,n)=>{let s=n.destination,a=s==null?void 0:s.url,i=ye(p=>an(r,o,p,e),Gt,!0);return((0,P.default)(n.send)?n.send:cr)(r,a,{method:(s==null?void 0:s.method)||n.method||ae.method,paramName:(s==null?void 0:s.filesParamName)||n.inputFieldName||lr,params:I(I({},n.params),s==null?void 0:s.params),forceJsonResponse:n.forceJsonResponse,withCredentials:n.withCredentials,formatGroupParamName:n.formatGroupParamName,headers:s==null?void 0:s.headers,sendWithFormData:n.sendWithFormData,formatServerResponse:n.formatServerResponse,formDataAllowUndefined:n.formDataAllowUndefined,isSuccessfulCall:n.isSuccessfulCall},i)}},Object.values(M));return t},dr=cn;var ln=b()&&"FileList"in window,dn=e=>I({params:{}},e),pr=e=>k(I(I({},ae),e),{destination:e&&e.destination?dn(e.destination):null}),ur=e=>ln&&e instanceof FileList||e.toString()==="[object FileList]",Te=(e,t=0)=>{let r=e;return(0,_.default)()||(t<3&&v(e)?r=y(e):t<3&&ee(e)&&(r=Array.isArray(e)?e.map(o=>Te(o,t+1)):Object.keys(e).reduce((o,n)=>(o[n]=Te(e[n],t+1),o),{}))),r};var fr=0,pn=(e,t,r,o)=>{let n=o?Array.prototype.map.call(t,s=>ue(s)?s.file||s.url:s):[];return Promise.all(Array.prototype.map.call(t,(s,a)=>{let i=(o||et)(n[a],a,n);return U(i)?i.then(c=>!!c&&s):!!i&&s})).then(s=>s.filter(Boolean).map(a=>He(a,e,r)))},un=(e,t,r)=>{fr+=1;let o=`batch-${fr}`,n=ur(e),s=Array.isArray(e)||n?e:[e],a=!r.autoUpload;return pn(o,s,a,r.fileFilter).then(i=>({id:o,uploaderId:t,items:i,state:a?E.PENDING:E.ADDED,completed:0,loaded:0,orgItemCount:i.length,additionalInfo:null}))},mr=un;var fn=(e,t,r,o)=>{let n=dr(),s=je(r,e,t,n,o);return{abortBatch:a=>{s.abortBatch(a)},abort:a=>{a?s.abortItem(a):s.abortAll()},addNewBatch:(a,i)=>mr(a,o,i).then(c=>{let p;if(c.items.length){let l=s.addBatch(c,i);p=s.runCancellable(m.BATCH_ADD,l,i).then(u=>(u?s.cancelBatch(l):(f.debugLog(`uploady.uploader [${o}]: new items added - auto upload =
                       ${String(i.autoUpload)}`,l.items),i.autoUpload&&s.uploadBatch(l)),l))}else f.debugLog(`uploady.uploader: no items to add. batch ${c.id} is empty. check fileFilter if this isn't intended`);return p||Promise.resolve(null)}),clearPendingBatches:()=>{s.clearPendingBatches()},processPendingBatches:a=>{s.uploadPendingBatches(a)}}},hr=fn;var mn=(...e)=>(t,...r)=>e.reduce((o,n)=>n(o,...r)||o,t),tt=mn;var hn=Object.values(m),gn="Uploady - uploader extensions can only be registered by enhancers",En="Uploady - uploader extension by this name [%s] already exists",rt=0,Sn=e=>tt(ze(),e),In=(e,t,r,o)=>{let n=t.enhancer?Sn(t.enhancer):ze();o(!0);let s=n(e,r);return o(!1),s||e},An=e=>{rt+=1;let t=`uploader-${rt}`,r=!1,o={};f.debugLog(`uploady.uploader: creating new instance (${t})`,{options:e,counter:rt});let n=pr(e),s=()=>{d.clearPendingBatches()},a=()=>V(n),{trigger:i,target:c}=$({id:t,update:g=>(n=B({},n,g),c),add:(g,S)=>{let R=B({},n,S);return R.clearPendingOnAdd&&s(),d.addNewBatch(g,R).then(()=>{f.debugLog("uploady.uploader: finished adding file data to be processed")})},upload:g=>{d.processPendingBatches(g)},abort:g=>{d.abort(g)},abortBatch:g=>{d.abortBatch(g)},getOptions:a,clearPending:s,registerExtension:(g,S)=>{(0,T.default)(r,gn),(0,T.default)(!o[g],En,g),f.debugLog(`uploady.uploader: registering extension: ${g.toString()}`,S),o[g]=S},getExtension:g=>o[g]},hn,{canAddEvents:!1,canRemoveEvents:!1}),p=(g,...S)=>{let R=Qe(()=>S.map(Te));return i(g,R)},l=De(p),u=In(c,n,p,g=>{r=g}),d=hr(p,l,n,u.id);return O(u)},gr=An;var Er=gr;var G=x(F());var xr=x(F());var Tr=x(F());var Sr=Symbol.for("_rpldy-version_"),ot=()=>"1.8.3",Ir=()=>b()?window:globalThis||process,nt=()=>Ir()[Sr],Ar=()=>{Ir()[Sr]=ot()},br=()=>{let e=nt();return!!e&&e!==ot()};var bn=Tr.default.createContext(null),Rr="Uploady - Context. File input isn't available",st=(e,t)=>{let r,o,n=!1;t?r=t:f.debugLog("Uploady context - didn't receive input field ref - waiting for external ref");let s=()=>r==null?void 0:r.current,a=()=>(r&&(n=!0),r),i=()=>n,c=()=>{let l=s();(0,T.default)(l,Rr),l.removeEventListener("change",c);let u=o;o=null,p(l.files,u)},p=(l,u)=>{e.add(l,u)};return Ar(),{hasUploader:()=>!!e,getInternalFileInput:a,setExternalFileInput:l=>{n=!0,r=l},getIsUsingExternalInput:i,showFileUpload:l=>{let u=s();(0,T.default)(u,Rr),o=l,u.removeEventListener("change",c),u.addEventListener("change",c),u.value="",u.click()},upload:p,processPending:l=>{e.upload(l)},clearPending:()=>{e.clearPending()},setOptions:l=>{e.update(l)},getOptions:()=>e.getOptions(),getExtension:l=>e.getExtension(l),abort:l=>{e.abort(l)},abortBatch:l=>{e.abortBatch(l)},on:(l,u)=>e.on(l,u),once:(l,u)=>e.once(l,u),off:(l,u)=>e.off(l,u)}},ie=bn;var Rn="Uploady - Valid UploadyContext not found. Make sure you render inside <Uploady>",Tn=`Uploady - Valid UploadyContext not found.
You may be using packages of different Uploady versions. <Uploady> and all other packages using the context provider must be of the same version: %s`,xn=e=>((0,T.default)(!br(),Tn,nt()),(0,T.default)(e&&e.hasUploader(),Rn),e),at=xn;var Pn=()=>at((0,xr.useContext)(ie)),L=Pn;var Pr=(e,t)=>{let r=L(),{on:o,off:n}=r;(0,G.useEffect)(()=>(o(e,t),()=>{n(e,t)}),[e,t,o,n])},xe=(e,t)=>(r,o)=>{let[n,s]=(0,G.useState)(null),a=r,i=o;r&&!(0,P.default)(r)&&(i=r,a=void 0);let c=(0,G.useCallback)((p,...l)=>{(!i||p.id===i)&&(s(t(p,...l)),(0,P.default)(a)&&a(p,...l))},[a,i]);return Pr(e,c),n},A=(e,t=!0)=>(r,o)=>{let n=(0,G.useCallback)((s,...a)=>r&&(!t||!o||s.id===o)?r(s,...a):void 0,[r,o]);Pr(e,n)};var _n=A(m.BATCH_ADD,!1),On=A(m.BATCH_START),Bn=A(m.BATCH_FINISH),Ln=A(m.BATCH_CANCEL),yn=A(m.BATCH_ERROR),Cn=A(m.BATCH_FINALIZE),Fn=A(m.BATCH_ABORT),Dn=xe(m.BATCH_PROGRESS,e=>I({},e)),Un=A(m.ITEM_START),vn=A(m.ITEM_FINISH),Nn=A(m.ITEM_CANCEL),wn=A(m.ITEM_ERROR),Hn=A(m.ITEM_ABORT),Mn=A(m.ITEM_FINALIZE),Gn=xe(m.ITEM_PROGRESS,e=>I({},e)),kn=A(m.REQUEST_PRE_SEND,!1),Vn=A(m.ALL_ABORT,!1);var _r=Symbol.for("rpldy_component");var Qn=e=>{e[_r]=!0};var _e=x(F());var Pe=x(F());var $n=(e,t)=>{let r=(0,Pe.useMemo)(()=>(f.debugLog("Uploady creating a new uploader instance",e),Er(e)),[e.enhancer]);return r.update(e),(0,Pe.useEffect)(()=>(t&&(f.debugLog("Uploady setting event listeners",t),Object.entries(t).forEach(([o,n])=>{r.on(o,n)})),()=>{t&&(f.debugLog("Uploady removing event listeners",t),Object.entries(t).forEach(([o,n])=>r.off(o,n)))}),[t,r]),r},Or=$n;var zn=e=>{let c=e,{listeners:t,debug:r,children:o,inputRef:n}=c,s=lt(c,["listeners","debug","children","inputRef"]);f.setDebug(!!r),f.debugLog("@@@@@@ Uploady Rendering @@@@@@",e);let a=Or(s,t),i=(0,_e.useMemo)(()=>st(a,n),[a,n]);return _e.default.createElement(ie.Provider,{value:i},o)},Wn=zn;var Yn=e=>{let t=L();return e&&t.setOptions(e),t.getOptions()},Xn=Yn;var Zn=x(F());var Jn=x(F());var Kn=x(F());var J=x(F());function it(){return it=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)({}).hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},it.apply(null,arguments)}var Oe=({eventType:e,getIsValidEventData:t,getRequestData:r})=>o=>n=>{let s=L(),[a,i]=(0,J.useState)({updateRequest:null,requestData:null}),{id:c}=n;return(0,J.useLayoutEffect)(()=>{let p=(...l)=>t(c,...l)===!0?new Promise(u=>{i({updateRequest:d=>{s.off(e,p),u(d)},requestData:r(...l)})}):void 0;return c&&s.on(e,p),()=>{c&&s.off(e,p)}},[s,c]),J.default.createElement(o,it({},n,a))};var pl=Oe({eventType:m.REQUEST_PRE_SEND,getIsValidEventData:(e,{items:t})=>!!t.find(r=>r.id===e),getRequestData:({items:e,options:t})=>({items:e,options:t})});var hl=Oe({eventType:m.BATCH_START,getIsValidEventData:(e,t)=>t.id===e,getRequestData:(e,t)=>({batch:e,items:e.items,options:t})});export{b as a,T as b,L as c,Gn as d,Qn as e,Wn as f,Xn as g};
